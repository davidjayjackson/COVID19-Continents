---
title: "COVID19 by Continents"
author: "David Jackson"
date: "10/23/2020"
output: 
  html_document: 
    fig_width: 9
    fig_height: 8
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message = FALSE,error = FALSE)
library(ggplot2)
library(scales)
library(RSQLite)
library(dplyr)
```
```{r,echo=FALSE}
rm(list=ls())
source("../DATA/movavg.R")
db <- db <- dbConnect(RSQLite::SQLite(),dbname= "../COVIDDB/COVID.sqlite3")
df <- dbGetQuery(db,"select * from ECDC")
df$Reported <- as.Date(df$Reported)
df <- df[order(df$Reported),]
```

### Count of Countries by Continent

```{r}
count_cont <- distinct(df, Countries, Continent) %>% count(Continent)
ggplot(count_cont) + geom_col(aes(x=reorder(Continent,n),y=n)) +
  labs(title="Count of Countries by Continent",x="Continent",y="Country Count")
  
```

### Population by Continent
```{r}
population_cont <- df %>% group_by(Continent) %>% 
  summarise(Pop = sum(Population))
ggplot(population_cont) + geom_col(aes(x=reorder(Continent,Pop),y=Pop)) +
  scale_y_continuous(labels=scales::comma) + coord_flip()
```


### Total Cases and Deaths

```{r}
total_cases <- aggregate(Cases~Continent,df,FUN=sum)
total_deaths <- aggregate(Deaths~Continent,df,FUN=sum)
## Daily totals by Continents
geoID_cases <- aggregate(Cases~Continent+geoID+Reported,df,FUN=sum)
geoID_deaths <- aggregate(Deaths~Continent+geoID+Reported,df,FUN=sum)
##
continent_cases <- aggregate(Cases~Continent+Reported,df,FUN=sum)
continent_deaths <- aggregate(Deaths~Continent+Reported,df,FUN=sum)

## US and Americas
america_cases <- subset(continent_cases,Continent =="America")
america_deaths <- subset(continent_deaths,Continent =="America")
```
```{r}
US <- subset(df,geoID =="US")
us_cases <- aggregate(Cases~Reported,US,FUN=sum)
us_deaths <- aggregate(Deaths~Reported,df,FUN=sum)
# compare_cases <-cbind(america_cases,us_cases)
# colnames(compare_cases) <- c("Continent","Date1","AMCases","Date2","USCases")
# compare_cases$rate <- compare_cases$USCases/compare_cases$uscases

```

```{r}
ggplot(total_cases,aes(x=reorder(Continent,Cases),y=Cases)) + geom_col() +
  labs(title="Total Number of Cases by Continent") +
  scale_y_continuous(labels = scales::comma)

ggplot(total_deaths,aes(x=reorder(Continent,Deaths),y=Deaths)) + geom_col() +
  labs(title="Total Number of Deaths by Continent") +
scale_y_continuous(labels = scales::comma)

```

#### PLot of Continents Cases and Deaths by Date

```{r}
ggplot(continent_cases) +
  geom_line(aes(x=Reported,y=Cases,col=Continent)) +
  labs("Total Cases by Continent and Day.")

ggplot(continent_deaths) +
  geom_line(aes(x=Reported,y=Deaths,col=Continent)) +
  labs("Total Deaths by Continent and Day.")
```
```{r}
ggplot(continent_cases) +
  geom_line(aes(x=Reported,y=Cases,col=Continent)) +
  labs(title="Total Cases by  Day.") + 
  facet_wrap(~Continent,ncol=1)

ggplot(continent_deaths) +
  geom_line(aes(x=Reported,y=Deaths,col=Continent)) +
  labs(title="Total Deaths by Continent and Day.") +
  facet_wrap(~Continent,ncol=1)
```

#### Plot of Loess Fitted curve by Continent

```{r}
ggplot(continent_cases) +
  geom_smooth(aes(x=Reported,y=Cases,col=Continent),span=0.1) +
  labs(title="Loess Fitted Curve(Cases) by  Continent and Day.")
  

ggplot(continent_deaths) +
  geom_smooth(aes(x=Reported,y=Deaths,col=Continent),span=0.1) +
  labs(title="Loess Fitted Curve(Deaths) by  Continent and Day.") 
  
```

